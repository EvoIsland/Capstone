<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AuraBot - Interfaz de Chat</title>
    
    <style>
        /* --- Definici√≥n de Colores y Fuentes --- */
        :root {
            --morado-suave: #7E57C2;
            --verde-menta: #26A69A;
            --blanco-lavanda: #F7F3FF;
            --gris-oscuro: #333333;
            --gris-medio: #5E5E5E;
            --fondo-app: #f0f4f8;
            --sombra: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --sombra-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* --- Reseteo B√°sico --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /* --- Estilo de Fuente Principal --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.5;
            background-color: var(--fondo-app);
            overflow: hidden; /* Evita el scroll de la p√°gina entera */
        }

        /* --- 1. Contenedor Principal (Estilo Gemini) --- */
        .app-layout {
            display: flex;
            height: 100vh;
            width: 100vw;
        }

        /* --- 2. Barra Lateral (Historial) --- */
        .sidebar {
            width: 260px;
            background-color: var(--blanco-lavanda);
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            padding: 1rem;
            transition: transform 0.3s ease;
            z-index: 100;
        }
        
        .sidebar-header {
            margin-bottom: 1rem;
        }

        .new-chat-btn {
            background-color: var(--verde-menta);
            color: white;
            border: none;
            padding: 0.75rem;
            width: 100%;
            border-radius: 9999px;
            cursor: pointer;
            font-weight: 500;
            font-size: 1rem;
            transition: transform 0.1s ease;
        }
        .new-chat-btn:hover {
            transform: scale(1.02);
        }
        .new-chat-btn:active {
            transform: scale(0.98);
        }

        .sidebar h3 {
            font-size: 0.875rem;
            color: var(--gris-medio);
            margin-bottom: 0.5rem;
            padding: 0 0.5rem;
        }

        .chat-history-list {
            display: flex;
            flex-direction: column; /* Se llenar√° de arriba hacia abajo */
            gap: 0.25rem;
            overflow-y: auto;
            flex: 1;
        }
        
        .history-item {
            padding: 0.6rem 0.75rem;
            border-radius: 0.5rem;
            text-decoration: none;
            color: var(--gris-oscuro);
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .history-item:hover {
            background-color: #e8e0f3; /* Lavanda m√°s oscuro */
        }
        .history-item.active {
            background-color: var(--morado-suave);
            color: white;
        }
        
        /* --- 3. Contenido Principal (Chat) --- */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            /* Padding para centrar el widget en escritorio */
            padding: 1rem; 
        }

        /* Bot√≥n de Men√∫ para M√≥vil (Hamburguesa) */
        .menu-toggle {
            display: none; /* Oculto en escritorio */
            position: absolute;
            top: 1.25rem;
            left: 1rem;
            z-index: 50;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            width: 40px;
            height: 40px;
        }
        .menu-toggle svg {
            width: 24px;
            height: 24px;
        }

        /* Overlay para cerrar el men√∫ en m√≥vil */
        .sidebar-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 99;
        }
        .sidebar-overlay.open {
            display: block;
        }


        /* --- 4. Widget de Chat (Adaptado) --- */
        .chat-widget {
            background-color: white;
            width: 100%;
            /* Centrado y con ancho m√°ximo en escritorio */
            max-width: 800px; 
            height: 100%;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            box-shadow: var(--sombra-lg);
            border-radius: 0.5rem;
            overflow: hidden;
        }

        /* --- 4a. Encabezado del Chat --- */
        .chat-header {
            background-color: var(--morado-suave);
            color: white;
            padding: 1rem;
            display: flex;
            align-items: center;
            /* Espacio a la izquierda para el bot√≥n de men√∫ en m√≥vil */
            padding-left: 4rem; 
            gap: 0.75rem;
            box-shadow: var(--sombra);
            z-index: 10;
            position: relative; /* Para el bot√≥n de men√∫ */
        }

        .header-avatar {
            width: 48px;
            height: 48px;
            border-radius: 9999px;
            background: linear-gradient(to bottom, var(--morado-suave), var(--verde-menta));
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .header-avatar svg { width: 24px; height: 24px; opacity: 0.9; }
        
        .header-info h1 { font-size: 1.125rem; font-weight: 700; }
        .header-status { display: flex; align-items: center; gap: 0.375rem; }
        .status-dot {
            width: 10px;
            height: 10px;
            background-color: var(--verde-menta);
            border-radius: 9999px;
            border: 2px solid rgba(255, 255, 255, 0.5);
        }
        .status-text { font-size: 0.875rem; opacity: 0.9; }

        /* --- 4b. Cuerpo del Chat --- */
        .chat-body {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            background-color: var(--blanco-lavanda);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .message-row { display: flex; }
        .message-row.user { justify-content: flex-end; }
        .message-row.bot { justify-content: flex-start; }
        
        .message-bubble {
            padding: 0.75rem 1rem;
            max-width: 80%;
            box-shadow: var(--sombra);
            word-wrap: break-word;
        }
        .message-bubble.bot {
            background-color: var(--morado-suave);
            color: white;
            border-radius: 1rem;
            border-top-left-radius: 0.25rem;
        }
        .message-bubble.user {
            background-color: white;
            color: var(--gris-oscuro);
            border: 1px solid #f0f0f0;
            border-radius: 1rem;
            border-top-right-radius: 0.25rem;
        }

        #typing-indicator { display: none; }
        .typing-indicator span {
            height: 8px; width: 8px; background-color: #999;
            border-radius: 50%; display: inline-block;
            animation: bounce 1.3s infinite;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes bounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-6px); }
        }

        /* --- 4c. Respuestas R√°pidas --- */
        .quick-replies {
            padding: 0.5rem;
            background-color: var(--blanco-lavanda);
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 0.5rem;
            white-space: nowrap;
            overflow-x: auto;
        }
        .quick-reply-btn {
            background-color: var(--verde-menta);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: transform 0.1s ease;
        }
        .quick-reply-btn:hover { transform: scale(1.05); }

        /* --- 4d. Barra de Entrada (Footer) --- */
        .chat-footer {
            background-color: white;
            padding: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            border-top: 1px solid #e5e7eb;
        }
        .chat-input {
            flex: 1;
            width: 100%;
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 9999px;
            outline: none;
            color: var(--gris-oscuro);
            font-size: 1rem;
        }
        .chat-input:focus {
            border-color: var(--morado-suave);
            box-shadow: 0 0 0 2px rgba(126, 87, 194, 0.3);
        }
        .send-button {
            background-color: var(--verde-menta);
            color: white;
            width: 40px; height: 40px;
            border-radius: 9999px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--sombra-lg);
            border: none;
            cursor: pointer;
            transition: transform 0.1s ease;
        }
        .send-button:hover { transform: scale(1.1); }
        .send-button svg { width: 20px; height: 20px; margin-right: -1px; }

        /* --- Estilo de la Barra de Scroll --- */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb {
            background: #c7b8da;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover { background: #b3a2c9; }
        
        /* --- 5. Responsividad para M√≥viles (<= 768px) --- */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: 0; top: 0;
                height: 100%;
                /* Oculto por defecto */
                transform: translateX(-100%); 
                box-shadow: var(--sombra-lg);
            }
            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                padding: 0; /* Sin padding en m√≥vil */
            }

            .chat-widget {
                height: 100vh; /* Pantalla completa */
                max-width: 100%;
                border-radius: 0;
            }

            .menu-toggle {
                display: block; /* Mostrar bot√≥n de men√∫ */
            }

            .chat-header {
                /* Reducir el padding izquierdo en m√≥vil para que el avatar no se monte */
                padding-left: 4.5rem; 
            }
        }

    </style>
</head>

<body>

    <div class="app-layout">

        <!-- Columna Izquierda: Historial -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <button class="new-chat-btn" id="new-chat-btn">+ Nuevo Chat</button>
            </div>
            
            <!-- T√çTULO CAMBIADO -->
            <h3>Conversaci√≥n Actual</h3>
            <!-- HISTORIAL DIN√ÅMICO (VACIADO) -->
            <nav class="chat-history-list" id="chat-history-list">
                <!-- El historial de preguntas aparecer√° aqu√≠ -->
            </nav>
        </aside>

        <!-- Overlay para cerrar el men√∫ en m√≥vil -->
        <div class="sidebar-overlay" id="sidebar-overlay"></div>

        <!-- Columna Derecha: Chat Principal -->
        <main class="main-content">

            <!-- El widget de chat que ya ten√≠amos -->
            <div class="chat-widget">

                <!-- ==== Encabezado (Header) ==== -->
                <header class="chat-header">
                    <!-- Bot√≥n de Men√∫ (Hamburguesa) -->
                    <button class="menu-toggle" id="menu-toggle">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                    </button>

                    <!-- Avatar del Bot -->
                    <div class="header-avatar">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path></svg>
                    </div>
                    
                    <!-- Nombre y Estado -->
                    <div class="header-info">
                        <h1>AuraBot</h1>
                        <div class="header-status">
                            <span class="status-dot"></span>
                            <span class="status-text">En l√≠nea</span>
                        </div>
                    </div>
                </header>

                <!-- ==== Cuerpo del Chat ==== -->
                <main id="chat-body" class="chat-body">
                    <div class="message-row bot">
                        <div class="message-bubble bot">
                            ¬°Hola! Soy AuraBot. ¬øEn qu√© puedo ayudarte hoy? ‚ú®
                        </div>
                    </div>
                    <div class="message-row user">
                        <div class="message-bubble user">
                            Hola, necesito ayuda con mi pedido.
                        </div>
                    </div>
                    <div id="typing-indicator" class="message-row bot">
                        <div class="message-bubble user">
                            <div class="typing-indicator">
                                <span></span><span></span><span></span>
                            </div>
                        </div>
                    </div>
                </main>

                <!-- ==== Respuestas R√°pidas ==== -->
                <div id="quick-replies" class="quick-replies">
                    <!-- Botones de JS -->
                </div>

                <!-- ==== Barra de Entrada ==== -->
                <footer class="chat-footer">
                    <input id="chat-input" type="text" placeholder="Escribe un mensaje..." class="chat-input">
                    <button id="send-button" class="send-button">
                        <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                    </button>
                </footer>
            </div>
        </main>
    </div>

    <!-- 
        ========================================
        SCRIPT ACTUALIZADO
        ========================================
    -->
    <script>
        // --- L√ìGICA DEL CHAT (MODIFICADA) ---
        const chatBody = document.getElementById('chat-body');
        const chatInput = document.getElementById('chat-input');
        const sendButton = document.getElementById('send-button');
        const quickRepliesContainer = document.getElementById('quick-replies');
        const typingIndicator = document.getElementById('typing-indicator');
        
        const botResponses = {
            "default": "No estoy seguro de entender. ¬øPodr√≠as reformularlo?",
            "hola": "¬°Hola de nuevo! ¬øEn qu√© m√°s te puedo ayudar? üòä",
            "pedido": "Claro, puedo ayudarte con tu pedido. ¬øQu√© te gustar√≠a hacer?",
            "rastrear": "Para rastrear tu pedido, necesitar√© tu n√∫mero de orden. ¬øMe lo puedes dar?",
            "cancelar": "Entendido. Para cancelar, por favor confirma tu n√∫mero de pedido y el motivo de la cancelaci√≥n."
        };
        
        const repliesOptions = {
            "pedido": ["Rastrear un pedido", "Cancelar un pedido"]
        };

        sendButton.addEventListener('click', sendMessage);
        chatInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') sendMessage();
        });

        function sendMessage() {
            const userText = chatInput.value.trim();
            if (userText === '') return;

            // 1. A√±ade el mensaje al chat y obt√©n su ID
            const userMessageId = addMessage(userText, 'user');
            
            // 2. A√±ade la pregunta al historial del sidebar
            addHistoryItem(userText, userMessageId);

            chatInput.value = '';
            clearQuickReplies();
            setTimeout(showBotResponse, 1200, userText);
            typingIndicator.style.display = 'flex';
            scrollToBottom();
        }

        function addMessage(text, sender) {
            // Crear un ID √∫nico para linkear
            const messageId = 'msg-' + Date.now() + Math.random().toString(36).substring(2, 9);
            
            const messageRow = document.createElement('div');
            messageRow.className = `message-row ${sender}`;
            messageRow.id = messageId; // Asignar el ID a la fila del mensaje

            const messageBubble = document.createElement('div');
            messageBubble.className = `message-bubble ${sender}`;
            messageBubble.textContent = text;
            
            messageRow.appendChild(messageBubble);
            chatBody.insertBefore(messageRow, typingIndicator);
            scrollToBottom();
            
            // Devolver el ID para que el historial lo use
            return messageId;
        }

        function showBotResponse(userText) {
            const lowerText = userText.toLowerCase();
            let botText = botResponses.default;
            let quickReplies = [];

            if (lowerText.includes("pedido")) {
                botText = botResponses.pedido;
                quickReplies = repliesOptions.pedido;
            } else if (lowerText.includes("hola")) {
                botText = botResponses.hola;
            } else if (lowerText.includes("rastrear")) {
                botText = botResponses.rastrear;
            } else if (lowerText.includes("cancelar")) {
                botText = botResponses.cancelar;
            }

            typingIndicator.style.display = 'none';
            addMessage(botText, 'bot'); // Los mensajes del bot no necesitan ID de historial
            if (quickReplies.length > 0) {
                addQuickReplies(quickReplies);
            }
        }

        function addQuickReplies(replies) {
            clearQuickReplies();
            replies.forEach(replyText => {
                const button = document.createElement('button');
                button.className = 'quick-reply-btn';
                button.textContent = replyText;
                button.addEventListener('click', () => {
                    chatInput.value = replyText;
                    sendMessage();
                });
                quickRepliesContainer.appendChild(button);
            });
            quickRepliesContainer.style.display = 'flex';
        }

        function clearQuickReplies() {
            quickRepliesContainer.innerHTML = '';
            quickRepliesContainer.style.display = 'none';
        }

        function scrollToBottom() {
            chatBody.scrollTop = chatBody.scrollHeight;
        }
        
        // Simular un mensaje inicial para llenar el historial
        // (Este es el mensaje de "Hola, necesito ayuda con mi pedido." que est√° en el HTML)
        // Lo ejecutamos despu√©s de un breve instante para que todo cargue
        setTimeout(() => {
            const initialMessage = document.querySelector('.message-row.user');
            if(initialMessage) {
                const initialText = initialMessage.textContent.trim();
                initialMessage.id = 'msg-initial-001';
                addHistoryItem(initialText, 'msg-initial-001');
            }
        }, 100);


        // --- L√ìGICA DE LA INTERFAZ Y NUEVO HISTORIAL ---
        const menuToggle = document.getElementById('menu-toggle');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebar-overlay');
        const newChatBtn = document.getElementById('new-chat-btn');
        const chatHistoryList = document.getElementById('chat-history-list');

        // Abrir/Cerrar men√∫ en m√≥vil
        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('open');
            overlay.classList.toggle('open');
        });

        overlay.addEventListener('click', () => {
            sidebar.classList.remove('open');
            overlay.classList.remove('open');
        });

        // 1. A√±adir un √≠tem al historial del sidebar
        function addHistoryItem(text, messageId) {
            const item = document.createElement('a');
            item.href = '#';
            item.className = 'history-item';
            item.textContent = text;
            item.dataset.messageId = messageId; // Link al ID del mensaje
            
            // Poner el nuevo al principio (como Gemini)
            chatHistoryList.prepend(item);
            
            // Marcar como activo
            chatHistoryList.querySelectorAll('.history-item').forEach(i => i.classList.remove('active'));
            item.classList.add('active');
        }

        // 2. Manejar clicks en el historial (Event Delegation)
        chatHistoryList.addEventListener('click', (e) => {
            const clickedItem = e.target.closest('.history-item');
            
            if (clickedItem) {
                e.preventDefault();
                
                // Marcar como activo
                chatHistoryList.querySelectorAll('.history-item').forEach(item => {
                    item.classList.remove('active');
                });
                clickedItem.classList.add('active');
                
                // Encontrar el mensaje en el chat
                const targetId = clickedItem.dataset.messageId;
                const messageElement = document.getElementById(targetId);
                
                if (messageElement) {
                    // Scroll hacia el mensaje
                    messageElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    
                    // Highlight temporal
                    messageElement.style.transition = 'background-color 0.5s ease';
                    messageElement.style.backgroundColor = '#e8e0f3'; // Color hover
                    setTimeout(() => {
                        messageElement.style.backgroundColor = '';
                    }, 1500);
                }
                
                // Cerrar men√∫ si estamos en m√≥vil
                if (window.innerWidth <= 768) {
                    sidebar.classList.remove('open');
                    overlay.classList.remove('open');
                }
            }
        });
        
        // 3. Bot√≥n de Nuevo Chat (Actualizado)
        newChatBtn.addEventListener('click', () => {
            // Limpiar cuerpo del chat
            chatBody.innerHTML = ''; 
            
            // Limpiar tambi√©n el historial del sidebar
            chatHistoryList.innerHTML = '';

            // A√±adir mensaje inicial
            addMessage("¬°Hola! Soy AuraBot. ¬øEn qu√© puedo ayudarte hoy? ‚ú®", 'bot');
            addQuickReplies(repliesOptions.pedido);
            
            // Cerrar men√∫ si estamos en m√≥vil
            if (window.innerWidth <= 768) {
                sidebar.classList.remove('open');
                overlay.classList.remove('open');
            }
        });

    </script>
</body>
</html>